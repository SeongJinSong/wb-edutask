# ğŸ“š ê°•ì˜ ê´€ë¦¬ API

## ğŸ“‹ ê°œìš”

ê°•ì˜ ë“±ë¡, ì¡°íšŒ, ì‹¤ì‹œê°„ ë­í‚¹ì„ ë‹´ë‹¹í•˜ëŠ” ê³ ì„±ëŠ¥ APIì…ë‹ˆë‹¤.

- **ì»¨íŠ¸ë¡¤ëŸ¬**: `CourseApiController`
- **ê¸°ë³¸ ê²½ë¡œ**: `/api/v1/courses`
- **ê¸°ëŠ¥**: ê°•ì˜ ë“±ë¡, ê°•ì˜ ì¡°íšŒ, ì‹¤ì‹œê°„ ë­í‚¹, í˜ì´ì§•
- **ê³ ê¸‰ ê¸°ëŠ¥**: Redis ZSet ë­í‚¹, í•˜ì´ë¸Œë¦¬ë“œ í˜ì´ì§•, ë™ì‹œì„± ì œì–´

## ğŸš€ API ì—”ë“œí¬ì¸íŠ¸

### 1. ê°•ì˜ ëª©ë¡ ì¡°íšŒ (ì‹¤ì‹œê°„ ë­í‚¹ + í˜ì´ì§•)

#### `GET /api/v1/courses`

ê°•ì˜ ëª©ë¡ì„ í˜ì´ì§•ìœ¼ë¡œ ì¡°íšŒí•˜ë©°, ì‹¤ì‹œê°„ ë­í‚¹ ì •ë ¬ì„ ì§€ì›í•©ë‹ˆë‹¤.

**ğŸ”¥ ê³ ê¸‰ ê¸°ëŠ¥**: 1í˜ì´ì§€ëŠ” Redis ZSetìœ¼ë¡œ ì´ˆê³ ì† ì‘ë‹µ, 2í˜ì´ì§€+ëŠ” DB ì¡°íšŒ

**ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°:**

| íŒŒë¼ë¯¸í„° | íƒ€ì… | í•„ìˆ˜ | ê¸°ë³¸ê°’ | ì„¤ëª… |
|----------|------|------|--------|------|
| `page` | Integer | âŒ | 0 | í˜ì´ì§€ ë²ˆí˜¸ (0ë¶€í„° ì‹œì‘) |
| `size` | Integer | âŒ | 20 | í˜ì´ì§€ í¬ê¸° |
| `sort` | String | âŒ | recent | ì •ë ¬ ê¸°ì¤€ |

**ì •ë ¬ ì˜µì…˜:**
- `recent`: ìµœê·¼ ë“±ë¡ìˆœ (ê¸°ë³¸ê°’)
- `applicants`: ì‹ ì²­ì ë§ì€ìˆœ âš¡ **ZSet ë­í‚¹**
- `remaining`: ì‹ ì²­ë¥  ë†’ì€ìˆœ âš¡ **ZSet ë­í‚¹**

**ì„±ê³µ ì‘ë‹µ (200 OK):**
```json
{
  "content": [
    {
      "id": 1,
      "courseName": "Spring Boot ë§ˆìŠ¤í„° í´ë˜ìŠ¤",
      "description": "ì‹¤ë¬´ ì¤‘ì‹¬ì˜ Spring Boot ê°•ì˜",
      "instructor": {
        "id": 2,
        "name": "ê¹€ê°•ì‚¬",
        "email": "instructor@weolbu.com"
      },
      "currentStudents": 15,
      "maxStudents": 30,
      "startDate": "2024-01-15",
      "endDate": "2024-03-15",
      "status": "SCHEDULED",
      "createdAt": "2024-01-01T10:00:00",
      "updatedAt": "2024-01-01T10:00:00"
    }
  ],
  "pageable": {
    "pageNumber": 0,
    "pageSize": 20,
    "sort": {
      "sorted": true,
      "direction": "DESC",
      "property": "applicants"
    }
  },
  "totalElements": 50,
  "totalPages": 3,
  "last": false,
  "first": true
}
```

**cURL ì˜ˆì‹œ:**
```bash
# ìµœê·¼ ë“±ë¡ìˆœ (ê¸°ë³¸)
curl -X GET "http://localhost:8080/api/v1/courses?page=0&size=20&sort=recent"

# ì‹ ì²­ì ë§ì€ìˆœ (ZSet ë­í‚¹)
curl -X GET "http://localhost:8080/api/v1/courses?page=0&size=20&sort=applicants"

# ì‹ ì²­ë¥  ë†’ì€ìˆœ (ZSet ë­í‚¹)
curl -X GET "http://localhost:8080/api/v1/courses?page=0&size=20&sort=remaining"

# 2í˜ì´ì§€ ì¡°íšŒ (DB ì¡°íšŒ)
curl -X GET "http://localhost:8080/api/v1/courses?page=1&size=20&sort=applicants"
```

### 2. ê°•ì˜ ë“±ë¡

#### `POST /api/v1/courses`

ìƒˆë¡œìš´ ê°•ì˜ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤.

**ìš”ì²­ ë³¸ë¬¸:**
```json
{
  "courseName": "Spring Boot ë§ˆìŠ¤í„° í´ë˜ìŠ¤",
  "description": "ì‹¤ë¬´ ì¤‘ì‹¬ì˜ Spring Boot ê°•ì˜",
  "instructorId": 2,
  "maxStudents": 30,
  "startDate": "2024-01-15",
  "endDate": "2024-03-15",
  "price": 150000
}
```

**ìš”ì²­ í•„ë“œ:**

| í•„ë“œ | íƒ€ì… | í•„ìˆ˜ | ì„¤ëª… | ì œì•½ì‚¬í•­ |
|------|------|------|------|----------|
| `courseName` | String | âœ… | ê°•ì˜ëª… | ìµœëŒ€ 100ì |
| `description` | String | âŒ | ê°•ì˜ ì„¤ëª… | ìµœëŒ€ 1000ì |
| `instructorId` | Long | âœ… | ê°•ì‚¬ ID | ì¡´ì¬í•˜ëŠ” ê°•ì‚¬ì—¬ì•¼ í•¨ |
| `maxStudents` | Integer | âœ… | ìµœëŒ€ ìˆ˜ê°•ì¸ì› | 1-100ëª… |
| `startDate` | Date | âŒ | ì‹œì‘ì¼ | YYYY-MM-DD í˜•ì‹ |
| `endDate` | Date | âŒ | ì¢…ë£Œì¼ | ì‹œì‘ì¼ ì´í›„ì—¬ì•¼ í•¨ |
| `price` | Integer | âŒ | ê°€ê²© | 0 ì´ìƒ |

**ì„±ê³µ ì‘ë‹µ (201 Created):**
```json
{
  "id": 1,
  "courseName": "Spring Boot ë§ˆìŠ¤í„° í´ë˜ìŠ¤",
  "description": "ì‹¤ë¬´ ì¤‘ì‹¬ì˜ Spring Boot ê°•ì˜",
  "instructor": {
    "id": 2,
    "name": "ê¹€ê°•ì‚¬",
    "email": "instructor@weolbu.com"
  },
  "currentStudents": 0,
  "maxStudents": 30,
  "startDate": "2024-01-15",
  "endDate": "2024-03-15",
  "status": "SCHEDULED",
  "createdAt": "2024-01-01T10:00:00",
  "updatedAt": "2024-01-01T10:00:00"
}
```

**ì—ëŸ¬ ì‘ë‹µ (400 Bad Request):**
```json
{
  "error": "ìœ íš¨ì„± ê²€ì¦ ì‹¤íŒ¨",
  "message": "ì…ë ¥ê°’ì„ í™•ì¸í•´ì£¼ì„¸ìš”",
  "details": {
    "maxStudents": "ìˆ˜ê°• ì •ì›ì€ 1ëª… ì´ìƒ 100ëª… ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤"
  }
}
```

**cURL ì˜ˆì‹œ:**
```bash
curl -X POST http://localhost:8080/api/v1/courses \
  -H "Content-Type: application/json" \
  -d '{
    "courseName": "Spring Boot ë§ˆìŠ¤í„° í´ë˜ìŠ¤",
    "description": "ì‹¤ë¬´ ì¤‘ì‹¬ì˜ Spring Boot ê°•ì˜",
    "instructorId": 2,
    "maxStudents": 30,
    "startDate": "2024-01-15",
    "endDate": "2024-03-15",
    "price": 150000
  }'
```

### 3. ê°•ì˜ ìƒì„¸ ì¡°íšŒ

#### `GET /api/v1/courses/{id}`

ê°•ì˜ IDë¡œ ê°•ì˜ ìƒì„¸ ì •ë³´ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.

**ê²½ë¡œ ë³€ìˆ˜:**

| ë³€ìˆ˜ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| `id` | Long | ê°•ì˜ ID |

**ì„±ê³µ ì‘ë‹µ (200 OK):**
```json
{
  "id": 1,
  "courseName": "Spring Boot ë§ˆìŠ¤í„° í´ë˜ìŠ¤",
  "description": "ì‹¤ë¬´ ì¤‘ì‹¬ì˜ Spring Boot ê°•ì˜",
  "instructor": {
    "id": 2,
    "name": "ê¹€ê°•ì‚¬",
    "email": "instructor@weolbu.com"
  },
  "currentStudents": 15,
  "maxStudents": 30,
  "startDate": "2024-01-15",
  "endDate": "2024-03-15",
  "status": "SCHEDULED",
  "createdAt": "2024-01-01T10:00:00",
  "updatedAt": "2024-01-01T10:00:00"
}
```

**cURL ì˜ˆì‹œ:**
```bash
curl -X GET http://localhost:8080/api/v1/courses/1
```

### 4. ê°•ì˜ ì‚­ì œ

#### `DELETE /api/v1/courses/{id}`

ê°•ì˜ë¥¼ ì‚­ì œí•©ë‹ˆë‹¤.

**ê²½ë¡œ ë³€ìˆ˜:**

| ë³€ìˆ˜ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| `id` | Long | ê°•ì˜ ID |

**ì„±ê³µ ì‘ë‹µ (200 OK):**
```json
{
  "message": "ê°•ì˜ê°€ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤."
}
```

**cURL ì˜ˆì‹œ:**
```bash
curl -X DELETE http://localhost:8080/api/v1/courses/1
```

## ğŸš€ ê³ ê¸‰ ê¸°ëŠ¥ - Redis ZSet ë­í‚¹

### ì‹¤ì‹œê°„ ë­í‚¹ ì‹œìŠ¤í…œ
- **ì‹ ì²­ì ë§ì€ìˆœ**: `currentStudents` ê¸°ì¤€ ZSet ì •ë ¬
- **ì‹ ì²­ë¥  ë†’ì€ìˆœ**: `currentStudents / maxStudents` ë¹„ìœ¨ ê¸°ì¤€ ì •ë ¬
- **40ê°œ ë²„í¼ì¡´**: ìˆ˜ê°•ì·¨ì†Œ ì‹œ ìˆœìœ„ ì•ˆì •ì„± ë³´ì¥

### í•˜ì´ë¸Œë¦¬ë“œ í˜ì´ì§•
```
ğŸ“Š ì„±ëŠ¥ ìµœì í™” ì „ëµ
â”œâ”€â”€ ğŸ¥‡ 1í˜ì´ì§€ (1-20ìœ„): Redis ZSet - ë°€ë¦¬ì´ˆ ë‹¨ìœ„ ì‘ë‹µ
â”œâ”€â”€ ğŸ›¡ï¸ ë²„í¼ì¡´ (21-40ìœ„): ìˆ˜ê°•ì·¨ì†Œ ëŒ€ë¹„ ì•ˆì •ì„± í™•ë³´
â””â”€â”€ ğŸ“š 2í˜ì´ì§€+ (41ìœ„~): DB ì¡°íšŒ - ì •í™•í•œ ë°ì´í„°
```

### ë™ì‹œì„± ì œì–´
- **Lua Script**: ì›ìì  ìˆ˜ê°•ì‹ ì²­ ì²˜ë¦¬
- **ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸**: ìˆ˜ê°•ì‹ ì²­ ì‹œ ZSet ì¦‰ì‹œ ë°˜ì˜
- **TTL ìºì‹œ**: 2ë¶„ ìë™ ë§Œë£Œë¡œ ë©”ëª¨ë¦¬ íš¨ìœ¨ì„±

## ğŸ“Š ì„±ëŠ¥ íŠ¹ì§•

### ì‘ë‹µ ì†ë„
- **1í˜ì´ì§€ ë­í‚¹**: ZSetìœ¼ë¡œ **ë°€ë¦¬ì´ˆ ë‹¨ìœ„** ì‘ë‹µ
- **2í˜ì´ì§€+**: DB ì¸ë±ìŠ¤ ìµœì í™”ë¡œ ë¹ ë¥¸ ì¡°íšŒ
- **N+1 ë¬¸ì œ í•´ê²°**: @BatchSizeë¡œ ì¿¼ë¦¬ ìµœì í™”

### í™•ì¥ì„±
- **ìˆ˜ì²œëª… ë™ì‹œ ì²˜ë¦¬**: Lua Script ì›ìì  ì²˜ë¦¬
- **ëŒ€ìš©ëŸ‰ ë°ì´í„°**: í˜ì´ì§•ìœ¼ë¡œ ë©”ëª¨ë¦¬ íš¨ìœ¨ì„±
- **Redis í´ëŸ¬ìŠ¤í„°**: ë” í° ê·œëª¨ í™•ì¥ ê°€ëŠ¥

### ì •í™•ì„±
- **ì •ì› ì´ˆê³¼ ë°©ì§€**: 100% ì •í™•ì„± ë³´ì¥
- **ë°ì´í„° ì •í•©ì„±**: ìŠ¤ì¼€ì¤„ëŸ¬ ê¸°ë°˜ Redis-DB ë™ê¸°í™”
- **ì‹¤ì‹œê°„ ë°˜ì˜**: ìˆ˜ê°•ì‹ ì²­ ì¦‰ì‹œ ë­í‚¹ ì—…ë°ì´íŠ¸

## ğŸ” ìœ íš¨ì„± ê²€ì¦ ê·œì¹™

### ê°•ì˜ëª… ê²€ì¦
- **ê¸¸ì´**: ìµœëŒ€ 100ì
- **í•„ìˆ˜**: ë°˜ë“œì‹œ ì…ë ¥í•´ì•¼ í•¨

### ìˆ˜ê°• ì •ì› ê²€ì¦
- **ë²”ìœ„**: 1ëª… ì´ìƒ 100ëª… ì´í•˜
- **í•„ìˆ˜**: ë°˜ë“œì‹œ ì…ë ¥í•´ì•¼ í•¨

### ë‚ ì§œ ê²€ì¦
- **í˜•ì‹**: YYYY-MM-DD
- **ë…¼ë¦¬**: ì¢…ë£Œì¼ì´ ì‹œì‘ì¼ ì´í›„ì—¬ì•¼ í•¨

### ê°•ì‚¬ ê²€ì¦
- **ì¡´ì¬ì„±**: ì‹¤ì œ ì¡´ì¬í•˜ëŠ” ê°•ì‚¬ì—¬ì•¼ í•¨
- **ê¶Œí•œ**: INSTRUCTOR ìœ í˜•ì´ì–´ì•¼ í•¨

## ğŸš¨ ì—ëŸ¬ ì¼€ì´ìŠ¤

### 1. ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê°•ì‚¬
```json
{
  "error": "ê°•ì‚¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤",
  "message": "í•´ë‹¹ IDì˜ ê°•ì‚¬ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."
}
```

### 2. ìœ íš¨ì„± ê²€ì¦ ì‹¤íŒ¨
```json
{
  "error": "ìœ íš¨ì„± ê²€ì¦ ì‹¤íŒ¨",
  "message": "ì…ë ¥ê°’ì„ í™•ì¸í•´ì£¼ì„¸ìš”",
  "details": {
    "maxStudents": "ìˆ˜ê°• ì •ì›ì€ 1ëª… ì´ìƒ 100ëª… ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤",
    "endDate": "ì¢…ë£Œì¼ì€ ì‹œì‘ì¼ ì´í›„ì—¬ì•¼ í•©ë‹ˆë‹¤"
  }
}
```

### 3. ê°•ì˜ ì‚­ì œ ì‹¤íŒ¨
```json
{
  "error": "ê°•ì˜ ì‚­ì œ ì‹¤íŒ¨",
  "message": "ìˆ˜ê°•ìƒì´ ìˆëŠ” ê°•ì˜ëŠ” ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
}
```

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### 1. ì •ìƒ ì¼€ì´ìŠ¤
- âœ… ê°•ì˜ ë“±ë¡
- âœ… ê°•ì˜ ëª©ë¡ ì¡°íšŒ (í˜ì´ì§•)
- âœ… ì‹¤ì‹œê°„ ë­í‚¹ ì •ë ¬ (ì‹ ì²­ì ë§ì€ìˆœ)
- âœ… ì‹¤ì‹œê°„ ë­í‚¹ ì •ë ¬ (ì‹ ì²­ë¥  ë†’ì€ìˆœ)
- âœ… ê°•ì˜ ìƒì„¸ ì¡°íšŒ
- âœ… ê°•ì˜ ì‚­ì œ

### 2. ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
- âœ… ZSet 1í˜ì´ì§€ ì‘ë‹µ ì†ë„ (ë°€ë¦¬ì´ˆ)
- âœ… DB 2í˜ì´ì§€+ ì‘ë‹µ ì†ë„
- âœ… ë™ì‹œ ìˆ˜ê°•ì‹ ì²­ ì²˜ë¦¬ (50ëª…)
- âœ… ë­í‚¹ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸

### 3. ì—ëŸ¬ ì¼€ì´ìŠ¤
- âŒ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê°•ì‚¬ë¡œ ë“±ë¡
- âŒ ì˜ëª»ëœ ìˆ˜ê°• ì •ì›
- âŒ ì˜ëª»ëœ ë‚ ì§œ ë²”ìœ„
- âŒ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê°•ì˜ ì¡°íšŒ

## ğŸ“ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸

### ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
```bash
# ZSet ë­í‚¹ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ (1í˜ì´ì§€)
time curl -X GET "http://localhost:8080/api/v1/courses?sort=applicants&page=0"

# DB ì¡°íšŒ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ (2í˜ì´ì§€)
time curl -X GET "http://localhost:8080/api/v1/courses?sort=applicants&page=1"

# ë™ì‹œì„± í…ŒìŠ¤íŠ¸ (50ëª… ë™ì‹œ ìˆ˜ê°•ì‹ ì²­)
./gradlew test --tests ConcurrencyTest
```

### ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
```bash
# ê°•ì˜ ë“±ë¡
curl -X POST http://localhost:8080/api/v1/courses \
  -H "Content-Type: application/json" \
  -d '{"courseName":"í…ŒìŠ¤íŠ¸ ê°•ì˜","instructorId":1,"maxStudents":10}'

# ë­í‚¹ ì¡°íšŒ (ì‹ ì²­ì ë§ì€ìˆœ)
curl -X GET "http://localhost:8080/api/v1/courses?sort=applicants"

# ë­í‚¹ ì¡°íšŒ (ì‹ ì²­ë¥  ë†’ì€ìˆœ)
curl -X GET "http://localhost:8080/api/v1/courses?sort=remaining"
```

## ğŸ”— ê´€ë ¨ íŒŒì¼

- **ì»¨íŠ¸ë¡¤ëŸ¬**: `src/main/java/com/wb/edutask/controller/CourseApiController.java`
- **ì„œë¹„ìŠ¤**: `src/main/java/com/wb/edutask/service/CourseService.java`
- **ë­í‚¹ ì„œë¹„ìŠ¤**: `src/main/java/com/wb/edutask/service/CourseRankingService.java`
- **ì—”í‹°í‹°**: `src/main/java/com/wb/edutask/entity/Course.java`
- **ë¦¬í¬ì§€í† ë¦¬**: `src/main/java/com/wb/edutask/repository/CourseRepository.java`
- **í…ŒìŠ¤íŠ¸**: `src/test/java/com/wb/edutask/service/CourseServiceTest.java`
- **ë™ì‹œì„± í…ŒìŠ¤íŠ¸**: `src/test/java/com/wb/edutask/service/ConcurrencyTest.java`

## ğŸ¯ ê¸°ìˆ ì  ìš°ìˆ˜ì„±

### ê¸°ë³¸ ìš”êµ¬ì‚¬í•­ ëŒ€ë¹„ ì¶”ê°€ êµ¬í˜„
- **ê¸°ë³¸**: ê°•ì˜ ë“±ë¡, ê°•ì˜ ì¡°íšŒ
- **ì¶”ê°€**: Redis ZSet ë­í‚¹, í•˜ì´ë¸Œë¦¬ë“œ í˜ì´ì§•, ë™ì‹œì„± ì œì–´, ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
- **ê¸°ìˆ **: Lua Script, ë¶„ì‚° ë½, TTL ìºì‹œ, 40ê°œ ë²„í¼ì¡´

### ì—”í„°í”„ë¼ì´ì¦ˆê¸‰ ì„±ëŠ¥
- **ì‘ë‹µ ì†ë„**: 1í˜ì´ì§€ ë°€ë¦¬ì´ˆ ë‹¨ìœ„ ì‘ë‹µ
- **ë™ì‹œì„±**: ìˆ˜ì²œëª… ë™ì‹œ ì²˜ë¦¬ ê°€ëŠ¥
- **í™•ì¥ì„±**: Redis í´ëŸ¬ìŠ¤í„°ë¡œ ë¬´í•œ í™•ì¥

### ì‹¤ì‹œê°„ ì‹œìŠ¤í…œ
- **ì¦‰ì‹œ ë°˜ì˜**: ìˆ˜ê°•ì‹ ì²­ ì‹œ ë­í‚¹ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
- **ì •í•©ì„± ë³´ì¥**: ìŠ¤ì¼€ì¤„ëŸ¬ ê¸°ë°˜ ìë™ ë™ê¸°í™”
- **ì•ˆì •ì„±**: 40ê°œ ë²„í¼ì¡´ìœ¼ë¡œ ìˆ˜ê°•ì·¨ì†Œ ì‹œì—ë„ ì•ˆì •ì 

---

**ê°•ì˜ ê´€ë¦¬ API** - ì‹¤ì‹œê°„ ë­í‚¹ê³¼ ê³ ì„±ëŠ¥ì„ ë³´ì¥í•˜ëŠ” ê°•ì˜ ê´€ë¦¬ ì‹œìŠ¤í…œ! ğŸ“š